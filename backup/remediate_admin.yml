---
    - name: Check if secret_admin account exists
      win_user:
        name: secret_admin
      register: admin_account_status

    - name: Re-enable ansible_admin account if disabled
      win_user:
        name: secret_admin
        account_disabled: no
      when: admin_account_status.account_disabled == true

    - name: Ensure secret_admin account is in Administrators group and has correct settings
      win_user:
        name: ansible_admin
        groups: Administrators
        state: present
        password: "SecurePass123!"
        password_never_expires: yes
        user_cannot_change_password: yes
        account_disabled: no
      when: admin_account_status.state != 'present' or admin_account_status.account_disabled == true
